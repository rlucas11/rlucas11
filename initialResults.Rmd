---
title: "Item-Order Replication"
subtitle: "Initial Results After First Pre-registered Study"
author: "Richard E. Lucas, Carol Tweten, and Felix Cheung"
date: "`r Sys.Date()`"
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
bibliography: "~/Dropbox/MyLibraryZ2.bib"
link-citations: yes
---

```{r setup, include=FALSE}
library(tufte)
# invalidate cache when the tufte version changes
knitr::opts_chunk$set(tidy = FALSE, cache.extra = packageVersion('tufte'))
options(htmltools.dir.version = FALSE)
```

# Introduction

The goal of this pre-registered project is to replicate and extend a result by @Deaton2011Se, who found that asking questions about politics before asking about subjective well-being led to lower levels of well-being than if the political questions had not been asked. The study was important because it was one of the few large-sample studies showing moderate context effects on well-being judgments [see @lucas_what_2016] and it contradicted one prior meta-analysis of item-order effects [@Schimmack2005JoPaSP]. In a commentary, Lucas et al. suggested one explanation for why the effect emerged in this study, even though it had been shown to be weak in prior studies. Specifically, we argued that the specific context of the survey (a political survey by the polling company Gallup) may have influenced respondents' interpretation of the specific well-being question that was asked (the "Ladder" question that is typically used by Gallup). Participants may have interpreted this ladder question as being an additional question about their overall satisfaction with government and its effects on their lives. Evidence for our hypothesis was the fact that asking a simple question about life satisfaction (one that explicitly mentioned respondents' "personal life") eliminated the item-order effect, a finding that ruled out simpler mood or information accessibility explanations. 

Thus, we proposed a study with three conditions. In the control condition, participants were first asked about their well-being and then about their political views. In a second condition that we believed was similar to the types of studies tested by Schimmack and Oishi (2005), we asked the same three political questions as in the original study, but presented the study as a study on student issues and opinions. In the final version, we presented the study as a study of political opinions and asked a variety of questions about voting behavior. We predicted there to be significantly different life satisfaction ratings when comparing the control to politics-salient condition, but not when comparing control to the student-life condition. We also expected the effects to be larger for the Ladder question used in the original study as compared to a standard life satisfaction question. We also tested whether the correlation between the political questions and the well-being measures varied depending on condition. Deaton (2012) did not examine these correlations, but prior investigations of item-order effects did. Finally, we expected correlations between the two well-being measures and additional outcomes assessed towards the end of the survey *not* to vary across conditions, as we did not expect validity to be impacted, even when the manipulation was successful. 

The preregistration form for this study is available [here](https://osf.io/fvkua/). Full materials are available [here](https://osf.io/jj97v/). 



# Mean Differences Across Conditions


```{r echo=FALSE, message=FALSE, warning=FALSE}
## Load packages
library(car)
library(ggplot2)
library(tidyr)
library(ez)
library(tidyr)
library(psych)
library(dplyr)
library(compute.es)

## Read Data
data <- read.csv("../data/final.csv")
data$Condition <- as.factor(data$Condition)
```


The table below shows means and standard deviations for the three conditions. Plots of the distributions across conditions are shown in the margin. 

```{r echo=FALSE}
## Means

condMeans <- data %>%
    group_by(Condition) %>%
    summarise(Mean.LS = mean(LSR, na.rm=TRUE),
              SD.LS = sd(LSR, na.rm=TRUE),
              Mean.Ladder = mean(LadderR, na.rm=TRUE),
              SD.Ladder = sd(LadderR, na.rm=TRUE),
              n.LS = sum(!is.na(LSR)),
              n.Ladder = sum(!is.na(LadderR)))
condMeans[,1] <- c("Politics Salient", "Student Life", "Control")

knitr::kable(
           condMeans,
           caption = 'Means and Standard Deviations by Condition',
           digits = 2,
           col.names = c("Condition", "LS Mean", "LS SD", "Ladder Mean", "Ladder SD",
                         "LS N", "Ladder N")
       )

computeD <- function(table, r1, r2, var) {
    var.mean <- paste("Mean", var, sep=".")
    var.sd <- paste("SD", var, sep=".")
    var.n <- paste("n", var, sep=".")
    compute.es::mes(m.1=condMeans[[r1,var.mean]], m.2=condMeans[[r2,var.mean]],
    sd.1=condMeans[[r1,var.sd]], sd.2=condMeans[[r2,var.sd]],
    n.1=condMeans[[r1,var.n]], n.2=condMeans[[r2,var.n]], verbose=FALSE)
}

dPolLS <- computeD(condMeans, 1, 3, "LS")$d 
dStuLS <- computeD(condMeans, 2, 3, "LS")$d 
dPolLad <- computeD(condMeans, 1, 3, "Ladder")$d 
dStuLad <- computeD(condMeans, 2, 3, "Ladder")$d 

```

```{r fig.margin=TRUE, fig.cap = "Life Satisfaction by Condition", fig.width=3.5, fig.height=3.5, cache=TRUE, message=FALSE, echo=FALSE}

p2 <- ggplot(data, aes(x=Condition, y=LSR)) +
    geom_violin()
p2 + geom_boxplot(width=.1) +
    scale_y_continuous(breaks=0:10,limits=c(0,10)) +
    stat_summary(fun.y=mean, geom="point", shape=23, size=2, color="red")
```

```{r fig.margin=TRUE, fig.cap = "Ladder Scores by Condition", fig.width=3.5, fig.height=3.5, cache=TRUE, message=FALSE, echo=FALSE}

p <- ggplot(data, aes(x=Condition, y=LadderR)) +
    geom_violin()
p + geom_boxplot(width=.1) +
    scale_y_continuous(breaks=0:10,limits=c(0,10)) +
    stat_summary(fun.y=mean, geom="point", shape=23, size=2, color="red")
```

```{r echo=FALSE}

lTestLS <- leveneTest(LSR ~ Condition, data=data)
lTestLadder <- leveneTest(LadderR ~ Condition, data=data)

```

Levene's test for homogeneity of variances was examined and was not significant either for life satisfaction, $`r paste0("F (", lTestLS$Df[1], ", ", lTestLS$Df[2], ") = ", round(lTestLS$F[1], 2), ", n.s.")`$, or ladder scores $`r paste0("F (", lTestLadder$Df[1], ", ", lTestLadder$Df[2], ") = ", round(lTestLadder$F[1], 2), ", n.s.")`$ One-way ANOVAs showed that the effect of condition was significant for life satisfaction but not for ladder scores. Preregistered planned contrasts comparing each condition to the control condition are presented in the tables below.

```{r echo=FALSE}

c1 <- c(0,1,-1)
c2 <- c(1,0,-1)
mat <- cbind(c1,c2)
contrasts(data$Condition) <- mat

fit <- aov(LadderR ~ Condition, data=data)
cTableLadder <- summary.aov(fit, split=list(Condition=list("Student Issues vs. Control"=1,
                                           "Politics Salient vs. Control"=2)))
fitLS <- aov(LSR ~ Condition, data=data)
cTableLS <- summary.aov(fitLS, split=list(Condition=list("Student Issues vs. Control"=1,
                                           "Politics Salient vs. Control"=2)))

knitr::kable(xtable::xtable(

    cTableLS,
    digits = 2
    
    ), digits = 2
)

knitr::kable(xtable::xtable(

    cTableLadder,
    digits = 2

    ), digits = 2
)


```

For life satisfaction, consistent both with the original study and our predictions, the difference in scores is largest between the control condition and the condition in which the political nature of the survey was made salient (*d =* `r dPolLS`, compared to *d =* `r dStuLS` for the student issues condition). This contrast for the politics-salient condition is significant. The contrast for the student-issues condition is not significant, though the effect size is positive and not that different than that from the politics-salient condition. It is important to note, however, that the direction of these effects are opposite to what is reported in the original study, where the inclusion of political questions led to lower well-being. For the ladder measure, the differences across condition were smaller (*d =* `r dPolLad` and `r dStuLad` for the politics and student-issues conditions, respectively) and not significant. 

```{r echo = FALSE, warning = FALSE}
dataLong <- data %>% gather(measure, score, LadderR, LSR)

rmLadder <- ezANOVA(data=dataLong,
                    dv=score,
                    wid=ID,
                    between=Condition,
                    within=measure)

knitr::kable(
  rmLadder,
  digits = 3,
  row.names = FALSE
  
)

```

# Figures

## Margin Figures

Images and graphics play an integral role in Tufte's work. To place figures in the margin you can use the **knitr** chunk option `fig.margin = TRUE`. For example:

```{r fig-margin, fig.margin = TRUE, fig.cap = "MPG vs horsepower, colored by transmission.", fig.width=3.5, fig.height=3.5, cache=TRUE, message=FALSE}
library(ggplot2)
mtcars2 <- mtcars
mtcars2$am <- factor(
  mtcars$am, labels = c('automatic', 'manual')
)
ggplot(mtcars2, aes(hp, mpg, color = am)) +
  geom_point() + geom_smooth() +
  theme(legend.position = 'bottom')
```

Note the use of the `fig.cap` chunk option to provide a figure caption. You can adjust the proportions of figures using the `fig.width` and `fig.height` chunk options. These are specified in inches, and will be automatically scaled down to fit within the handout margin.

## Arbitrary Margin Content

In fact, you can include anything in the margin using the **knitr** engine named `marginfigure`. Unlike R code chunks ```` ```{r} ````, you write a chunk starting with ```` ```{marginfigure} ```` instead, then put the content in the chunk. See an example on the right about the first fundamental theorem of calculus.

```{marginfigure}
We know from _the first fundamental theorem of calculus_ that for $x$ in $[a, b]$:
$$\frac{d}{dx}\left( \int_{a}^{x} f(u)\,du\right)=f(x).$$
```

For the sake of portability between LaTeX and HTML, you should keep the margin content as simple as possible (syntax-wise) in the `marginefigure` blocks. You may use simple Markdown syntax like `**bold**` and `_italic_` text, but please refrain from using footnotes, citations, or block-level elements (e.g. blockquotes and lists) there.

Note: if you set `echo = FALSE` in your global chunk options, you will have to add `echo = TRUE` to the chunk to display a margin figure, for example ```` ```{marginfigure, echo = TRUE} ````.

## Full Width Figures

You can arrange for figures to span across the entire page by using the chunk option `fig.fullwidth = TRUE`.

```{r fig-fullwidth, fig.width = 10, fig.height = 2, fig.fullwidth = TRUE, fig.cap = "A full width figure.", warning=FALSE, message=FALSE, cache=TRUE}
ggplot(diamonds, aes(carat, price)) + geom_smooth() +
  facet_grid(~ cut)
```

 Other chunk options related to figures can still be used, such as `fig.width`, `fig.cap`, `out.width`, and so on. For full width figures, usually `fig.width` is large and `fig.height` is small. In the above example, the plot size is $10 \times 2$.

## Main Column Figures

Besides margin and full width figures, you can of course also include figures constrained to the main column. This is the default type of figures in the LaTeX/HTML output.

```{r fig-main, fig.cap = "A figure in the main column.", cache=TRUE}
ggplot(diamonds, aes(cut, price)) + geom_boxplot()
```

# Sidenotes

One of the most prominent and distinctive features of this style is the extensive use of sidenotes. There is a wide margin to provide ample room for sidenotes and small figures. Any use of a footnote will automatically be converted to a sidenote. ^[This is a sidenote that was entered using a footnote.] 

If you'd like to place ancillary information in the margin without the sidenote mark (the superscript number), you can use the `margin_note()` function from **tufte** in an inline R expression. `r margin_note("This is a margin note.  Notice that there is no number preceding the note.")` This function does not process the text with Pandoc, so Markdown syntax will not work here. If you need to write anything in Markdown syntax, please use the `marginfigure` block described previously.

# References

References can be displayed as margin notes for HTML output. For example, we can cite R here [@R-base]. To enable this feature, you must set `link-citations: yes` in the YAML metadata, and the version of `pandoc-citeproc` should be at least 0.7.2. You can always install your own version of Pandoc from http://pandoc.org/installing.html if the version is not sufficient. To check the version of `pandoc-citeproc` in your system, you may run this in R:

```{r eval=FALSE}
system2('pandoc-citeproc', '--version')
```

If your version of `pandoc-citeproc` is too low, or you did not set `link-citations: yes` in YAML, references in the HTML output will be placed at the end of the output document.

# Tables

You can use the `kable()` function from the **knitr** package to format tables that integrate well with the rest of the Tufte handout style. The table captions are placed in the margin like figures in the HTML output.

```{r}
knitr::kable(
  mtcars[1:6, 1:6], caption = 'A subset of mtcars.'
)
```

# Block Quotes

We know from the Markdown syntax that paragraphs that start with `>` are converted to block quotes. If you want to add a right-aligned footer for the quote, you may use the function `quote_footer()` from **tufte** in an inline R expression. Here is an example:

> "If it weren't for my lawyer, I'd still be in prison. It went a lot faster with two people digging."
>
> `r tufte::quote_footer('--- Joe Martin')`

Without using `quote_footer()`, it looks like this (the second line is just a normal paragraph):

> "Great people talk about ideas, average people talk about things, and small people talk about wine."
>
> --- Fran Lebowitz

# Responsiveness

The HTML page is responsive in the sense that when the page width is smaller than 760px, sidenotes and margin notes will be hidden by default. For sidenotes, you can click their numbers (the superscripts) to toggle their visibility. For margin notes, you may click the circled plus signs to toggle visibility.

# More Examples

The rest of this document consists of a few test cases to make sure everything still works well in slightly more complicated scenarios. First we generate two plots in one figure environment with the chunk option `fig.show = 'hold'`:

```{r fig-two-together, fig.cap="Two plots in one figure environment.", fig.show='hold', cache=TRUE, message=FALSE}
p <- ggplot(mtcars2, aes(hp, mpg, color = am)) +
  geom_point()
p
p + geom_smooth()
```

Then two plots in separate figure environments (the code is identical to the previous code chunk, but the chunk option is the default `fig.show = 'asis'` now):

```{r fig-two-separate, ref.label='fig-two-together', fig.cap=sprintf("Two plots in separate figure environments (the %s plot).", c("first", "second")), cache=TRUE, message=FALSE}
```

You may have noticed that the two figures have different captions, and that is because we used a character vector of length 2 for the chunk option `fig.cap` (something like `fig.cap = c('first plot', 'second plot')`).

Next we show multiple plots in margin figures. Similarly, two plots in the same figure environment in the margin:

```{r fig-margin-together, fig.margin=TRUE, fig.show='hold', fig.cap="Two plots in one figure environment in the margin.", fig.width=3.5, fig.height=2.5, cache=TRUE}
p
p + geom_smooth(method = 'lm')
```

Then two plots from the same code chunk placed in different figure environments:

```{r fig-margin-separate, fig.margin=TRUE, fig.cap=sprintf("Two plots in separate figure environments in the margin (the %s plot).", c("first", "second")), fig.width=3.5, fig.height=2.5, cache=TRUE}
knitr::kable(head(iris, 15))
p
knitr::kable(head(iris, 12))
p + geom_smooth(method = 'lm')
knitr::kable(head(iris, 5))
```

We blended some tables in the above code chunk only as _placeholders_ to make sure there is enough vertical space among the margin figures, otherwise they will be stacked tightly together. For a practical document, you should not insert too many margin figures consecutively and make the margin crowded. 

You do not have to assign captions to figures. We show three figures with no captions below in the margin, in the main column, and in full width, respectively.

```{r fig-nocap-margin, fig.margin=TRUE, fig.width=3.5, fig.height=2, cache=TRUE}
# a boxplot of weight vs transmission; this figure
# will be placed in the margin
ggplot(mtcars2, aes(am, wt)) + geom_boxplot() +
  coord_flip()
```
```{r fig-nocap-main, cache=TRUE}
# a figure in the main column
p <- ggplot(mtcars, aes(wt, hp)) + geom_point()
p
```
```{r fig-nocap-fullwidth, fig.fullwidth=TRUE, fig.width=10, fig.height=3, cache=TRUE}
# a fullwidth figure
p + geom_smooth(method = 'lm') + facet_grid(~ gear)
```

# Some Notes on Tufte CSS

There are a few other things in Tufte CSS that we have not mentioned so far. If you prefer `r sans_serif('sans-serif fonts')`, use the function `sans_serif()` in **tufte**. For epigraphs, you may use a pair of underscores to make the paragraph italic in a block quote, e.g.

> _I can win an argument on any topic, against any opponent. People know this, and steer clear of me at parties. Often, as a sign of their great respect, they don't even invite me._
>
> `r quote_footer('--- Dave Barry')`

We hope you will enjoy the simplicity of R Markdown and this R package, and we sincerely thank the authors of the Tufte-CSS and Tufte-LaTeX projects for developing the beautiful CSS and LaTeX classes. Our **tufte** package would not have been possible without their heavy lifting.

You can turn on/off some features of the Tufte style in HTML output. The default features enabled are:

```yaml
output:
  tufte::tufte_html:
    tufte_features: ["fonts", "background", "italics"]
```

If you do not want the page background to be lightyellow, you can remove `background` from `tufte_features`. You can also customize the style of the HTML page via a CSS file. For example, if you do not want the subtitle to be italic, you can define

```css
h3.subtitle em {
  font-style: normal;
}
```

in, say, a CSS file `my_style.css` (under the same directory of your Rmd document), and apply it to your HTML output via the `css` option, e.g.,

```yaml
output:
  tufte::tufte_html:
    tufte_features: ["fonts", "background"]
    css: "my_style.css"
```

There is also a variant of the Tufte style in HTML/CSS named "[Envisoned CSS](http://nogginfuel.com/envisioned-css/)". This style can be used by specifying the argument `tufte_variant = 'envisioned'` in `tufte_html()`^[The actual Envisioned CSS was not used in the **tufte** package. We only changed the fonts, background color, and text color based on the default Tufte style.], e.g.

```yaml
output:
  tufte::tufte_html:
    tufte_variant: "envisioned"
```

To see the R Markdown source of this example document, you may follow [this link to Github](https://github.com/rstudio/tufte/raw/master/inst/rmarkdown/templates/tufte_html/skeleton/skeleton.Rmd), use the wizard in RStudio IDE (`File -> New File -> R Markdown -> From Template`), or open the Rmd file in the package:

```{r eval=FALSE}
file.edit(
  tufte:::template_resources(
    'tufte_html', '..', 'skeleton', 'skeleton.Rmd'
  )
)
```

This document is also available in [Chinese](http://rstudio.github.io/tufte/cn/), and its `envisioned` style can be found [here](http://rstudio.github.io/tufte/envisioned/).

```{r bib, include=FALSE}
# create a bib file for the R packages used in this document
knitr::write_bib(c('base', 'rmarkdown'), file = 'skeleton.bib')
```
